<?xml version="1.0" encoding="utf-8"?>

<!--
	Furnace with scattering

	This test is essentially the same as the isotropic furnace, but the
	furnace is now filled with a purely scattering medium. This does not 
	change anything about the answer.

	Caveat: because Nori only supports triangle meshes, the sphere
	is only approximate.
-->

<test type="ttest">
	<string name="references" value="2, 2, 2, 2, 2, 2, 2, 2"/>

	<scene>
		<integrator type="path"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.1 0.1 0.1"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="path"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.2 0.2 0.2"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="path"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.3 0.3 0.3"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="path"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.5 0.5 0.5"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="mipath"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.1 0.1 0.1"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="mipath"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.2 0.2 0.2"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="mipath"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.3 0.3 0.3"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>

	<scene>
		<integrator type="mipath"/>

		<camera type="perspective">
			<float name="fov" value="0.001"/>
			<integer name="width" value="1"/>
			<integer name="height" value="1"/>
		</camera>

		<mesh type="obj">
			<string name="filename" value="invsphere.obj"/>
			<bsdf type="diffuse">
				<color name="albedo" value="0.5, 0.5, 0.5"/>
			</bsdf>
			<luminaire type="area">
				<color name="radiance" value="1, 1, 1"/>
			</luminaire>
		</mesh>

		<medium type="homogeneous">
			<color name="sigmaA" value="0.0 0.0 0.0"/>
			<color name="sigmaS" value="0.5 0.5 0.5"/>
			<transform name="toWorld">
				<scale value="10 10 10"/>
				<translate value="-5 -5 -5"/>
			</transform>
		</medium>
	</scene>
</test>
